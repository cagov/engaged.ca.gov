{% extends "layout.njk" %}
{% block content %}

<section id="findings-overview">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        {{ modules.findings_overview.content | safe }}
      </div>
    </div>
  </div>
  <img class="findings-corner-adornment" src="/public/images/findings-corner-adornment.svg" aria-hidden="true" alt="Findings corner adornment">
</section>

<section id="findings-over700">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="findings-indent-container">
          {{ modules.findings_over700.content | safe }}
        </div>
      </div>
    </div>
  </div>
</section>


<section id="findings-how-we-listened">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="findings-indent-container">
          {{ modules.findings_how_we_listened.content | safe }}
        </div>
      </div>
    </div>
  </div>
</section>

<section id="findings-topics-people-rated">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="findings-indent-container">
          {{ modules.findings_topics_people_rated.content | safe }}
        </div>
      </div>
      <div class="findings-indent-container">
        <div class="findings-barchart-container collapsed">
            {% for item in barchart %}
            {% set visible = loop.index <= 4 %}
            <div class="findings-barchart-item{% if visible %} visible{% endif %}">
                <div class="findings-barchart-item-approval">{{ item.approval | round }}%</div>
                <div class="findings-barchart-bar" data-percentage="{{ item.approval }}"></div>
                <div class="findings-barchart-item-caption">{{loop.index}} {{ modules.findings_bar_chart[item.key] }}</div>
            </div>
            {% endfor %}
        </div>



        <div class="findings-button-container">
            <a id="findings-show-all-button" href="#" data-appearance="button" data-theme="orange">
            {{ modules.findings_topics_people_rated.buttonText }}
            <img src="/public/images/arrow-down.svg" alt="Show all" class="findings-show-all-button-icon">
            </a>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="findings-issues">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="findings-indent-container">
                    {{ modules.findings_issues_for_further_discussion.content | safe }}
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="findings-balloons-container">
                        <div class="findings-quote findings-quote-container-1">
                            {{ modules.findings_quote_1.content | safe }}
                            <img class="findings-quote-balloon-tip-1" src="/public/images/balloon-tip-1.svg" aria-hidden="true">
                        </div>
                        <div class="findings-quote findings-quote-container-2">
                            {{ modules.findings_quote_2.content | safe }}
                            <img class="findings-quote-balloon-tip-2" src="/public/images/balloon-tip-2.svg" aria-hidden="true">
                        </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="findings-key-tensions-label">
                    {{ modules.findings_key_tensions.content | safe }}
                </div>
                <div class="findings-key-tensions-container">
                    <div class="findings-key-tension-block">
                        <img class="findings-icon" src="/public/images/{{ modules.findings_key_tension_build_back.icon }}" aria-hidden="true" alt="{{ modules.findings_key_tension_build_back.iconAlt }}">
                        <div class="findings-key-tension-heading">
                            {{ modules.findings_key_tension_build_back.content | safe }}
                        </div>
                        <div class="findings-key-tension-read-more">
                            {{ modules.findings_key_tensions.readMore | safe }}
                        </div>
                    </div>
                    <div class="findings-key-tension-block">
                        <img class="findings-icon" src="/public/images/{{ modules.findings_key_tension_public_private.icon }}" aria-hidden="true" alt="{{ modules.findings_key_tension_public_private.iconAlt }}">
                        <div class="findings-key-tension-heading">
                            {{ modules.findings_key_tension_public_private.content | safe }}
                        </div>
                        <div class="findings-key-tension-read-more">
                            {{ modules.findings_key_tensions.readMore | safe }}
                        </div>
                    </div>
                    <div class="findings-key-tension-block">
                        <img class="findings-icon" src="/public/images/{{ modules.findings_key_tension_individual_collective.icon }}" aria-hidden="true" alt="{{ modules.findings_key_tension_individual_collective.iconAlt }}">
                        <div class="findings-key-tension-heading">
                            {{ modules.findings_key_tension_individual_collective.content | safe }}
                        </div>
                        <div class="findings-key-tension-read-more">
                            {{ modules.findings_key_tensions.readMore | safe }}
                        </div>
                    </div>
                    <div class="findings-key-tension-block">
                        <img class="findings-icon" src="/public/images/{{ modules.findings_key_tension_insurance.icon }}" aria-hidden="true" alt="{{ modules.findings_key_tension_insurance.iconAlt }}">
                        <div class="findings-key-tension-heading">
                            {{ modules.findings_key_tension_insurance.content | safe }}
                        </div>
                        <div class="findings-key-tension-read-more">
                            {{ modules.findings_key_tensions.readMore | safe }}
                        </div>
                    </div>
                    <div class="findings-key-tension-block">
                        <img class="findings-icon" src="/public/images/{{ modules.findings_key_tension_modernize.icon }}" aria-hidden="true" alt="{{ modules.findings_key_tension_modernize.iconAlt }}">
                        <div class="findings-key-tension-heading">
                            {{ modules.findings_key_tension_modernize.content | safe }}
                        </div>
                        <div class="findings-key-tension-read-more">
                            {{ modules.findings_key_tensions.readMore | safe }}
                        </div>
                    </div>
                </div>
                <div class="findings-button-container">
                    <a href="#" data-appearance="button" data-theme="orange">
                    {{ modules.findings_download_button.buttonText }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="findings-whats-next">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="findings-indent-container">
                    {{ modules.findings_whats_next.content | safe }}
                </div>
            </div>
        </div>
        <div class="findings-indent-container">
            <div class="findings-button-container">
                <a href="/lafires-recovery/#sign-up" data-appearance="button" data-theme="orange">
                {{ modules.findings_whats_next.buttonText }}
                </a>
            </div>
        </div>
    </div>
</section>


<script>
document.addEventListener('DOMContentLoaded', function() {
  const barElements = document.querySelectorAll('.findings-barchart-bar');
  
  barElements.forEach(barElement => {
    const percentage = parseFloat(barElement.getAttribute('data-percentage'));
    
    // Create SVG element with responsive dimensions
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', '100%');
    svg.setAttribute('height', '20');
    svg.setAttribute('viewBox', '0 0 100 20');
    svg.setAttribute('preserveAspectRatio', 'none');
    
    // Create the thin background horizontal line (2px high)
    const horizontalLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    horizontalLine.setAttribute('x1', '0');
    horizontalLine.setAttribute('y1', '10');
    horizontalLine.setAttribute('x2', '100');
    horizontalLine.setAttribute('y2', '10');
    horizontalLine.setAttribute('stroke', '#BCBBC1');
    horizontalLine.setAttribute('stroke-width', '2');
    
    // Create the thicker percentage line (6px thick)
    const percentageLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    percentageLine.setAttribute('x1', '0');
    percentageLine.setAttribute('y1', '10');
    percentageLine.setAttribute('x2', percentage);
    percentageLine.setAttribute('y2', '10');
    percentageLine.setAttribute('stroke', '#5489A3');
    percentageLine.setAttribute('stroke-width', '6');
    
    // Add lines to SVG
    svg.appendChild(horizontalLine);
    svg.appendChild(percentageLine);
    
    // Clear existing content and append SVG
    barElement.innerHTML = '';
    barElement.appendChild(svg);
  });
});


document.getElementById('findings-show-all-button').addEventListener('click', function() {
  // Prevent the default action and stop event propagation
  event.preventDefault();
  event.stopPropagation();
  const barchartContainer = document.querySelector('.findings-barchart-container');
  var isCollapsed = barchartContainer.classList.contains('collapsed');
  barchartContainer.classList.toggle('collapsed');
  isCollapsed = !isCollapsed;
  if (isCollapsed) {
    this.querySelector('.findings-show-all-button-icon').src = '/public/images/arrow-down.svg';
  } else {
    this.querySelector('.findings-show-all-button-icon').src = '/public/images/arrow-up.svg';
  }
  var barItems = document.querySelectorAll('.findings-barchart-item');
  barItems.forEach((barItem, index) => {
    if (isCollapsed) {
        barItem.classList.remove('visible');
        // When collapsing, only make the first 4 items visible
        if (index < 4) {
            barItem.classList.add('visible');
        }
    } else {
        barItem.classList.add('visible');
    }
  });

  // this.textContent = barchartContainer.classList.contains('collapsed') ? 'Show All' : 'Show Less';
});
</script>


{% endblock %}